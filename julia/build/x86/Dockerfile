## This file was autogenerated
# Do not edit directly; edit Makefile
FROM multiarch/debian-debootstrap:i386

# Set things like MARCH and JULIA_CPU_TYPES
ARG ARCH_FLAGS="JULIA_CPU_TARGET=pentium4 MARCH=pentium4"

# The revision of Julia we're building
ARG REVISION

# These are the build dependencies for Julia
ARG BUILD_DEPS="build-essential gfortran m4 python python-dev cmake curl git patchelf"
RUN apt update && apt install -y ${BUILD_DEPS}

# Clone julia, build and install
RUN git clone https://github.com/JuliaLang/julia.git /julia_build
WORKDIR /julia_build
RUN git checkout ${REVISION}
RUN make -j4 ${ARCH_FLAGS} prefix=/usr install

# Run fixup-libgfortran so that we store away our necessary libraries
# before uninstalling libgfortran
RUN ./contrib/fixup-libgfortran.sh /usr/lib/julia/

# Cleanup afterward
WORKDIR /
RUN rm -rf /julia_build
RUN apt remove -y ${BUILD_DEPS}; apt autoremove -y; apt-get -y clean
RUN apt-get -y purge; rm -rf /var/lib/apt/lists/*

CMD ["/usr/bin/julia"]

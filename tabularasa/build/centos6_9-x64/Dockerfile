## This file was autogenerated
# Do not edit directly; edit the .harbor files
#
# To build this docker image via `make`, run `make build-centos6_9-x64` in the `workerbase` directory
# To build this docker image manually, run `docker build --pull -t staticfloat/tabularasa_centos6_9:x64 .`

FROM centos:6.9




MAINTAINER Elliot Saba <staticfloat@gmail.com>
USER root

# We create a `buildworker` user so that we don't have to run everything as root
RUN useradd -m -s /bin/bash buildworker

# This is where we'll do all our work, so make it now
RUN mkdir -p /src
RUN chown buildworker:buildworker /src
## Download and install needed build dependencies for x86_64 yum-based systems
USER root

# Start with tools that I love and always need by my side
RUN ${L32} yum update -y && ${L32} yum install -y htop tmux vim curl net-tools which gdb

# Move on to bare necessities for Julia
RUN ${L32} yum install -y gcc gcc-c++ gcc-gfortran m4 make openssl openssl-devel patch

# Dependencies we need to build git
RUN ${L32} yum install -y curl-devel expat-devel gettext-devel perl-devel

# Dependencies we need to build gcc
RUN ${L32} yum install -y wget bzip2 tar

# Dependencies we need to build python
RUN ${L32} yum install -y zlib-devel bzip2-devel

# Dependencies we need to build tar
RUN ${L32} yum install -y xz

# Dependencies we need to do nightly SRPM packaging
RUN ${L32} yum install -y rpmdevtools
## Install python
ARG python_version=2.7.13
ARG python_url=https://www.python.org/ftp/python/${python_version}/Python-${python_version}.tar.xz
ARG pip_url=https://bootstrap.pypa.io/get-pip.py

USER buildworker
WORKDIR /src

# Download/extract both Python and pip
RUN curl -q -# -L "${python_url}" -o Python-${python_version}.tar.xz
RUN curl -q -# -L "${pip_url}" -o get-pip.py
RUN tar Jxf Python-${python_version}.tar.xz

# Build the python sources!
WORKDIR /src/Python-${python_version}
RUN ${L32} ./configure --prefix=/usr/local
RUN ${L32} make -j4

# Install python
USER root
RUN ${L32} make install

# Install pip and install virtualenv (all as root, of course)
RUN python /src/get-pip.py
RUN pip install virtualenv

# Now cleanup /src
WORKDIR /src
RUN rm -rf Python-${python_version}*
RUN rm -f get-pip.py
USER root

# We need to override ld.so.conf to search /usr/local before /usr
RUN echo "/usr/local/lib64" > /etc/ld.so.conf.new; \
    echo "/usr/local/lib" >> /etc/ld.so.conf.new; \
    cat /etc/ld.so.conf >> /etc/ld.so.conf.new; \
    mv /etc/ld.so.conf.new /etc/ld.so.conf; \
    ldconfig

# These are our final words. Always.
WORKDIR /

# Use /entrypoint.sh hack to get around the whole ${L32} ARG not being used in ENTRYPOINT thing.
RUN echo "#!/bin/bash" > /entrypoint.sh; echo "${L32} \"\$@\"" >> /entrypoint.sh; chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
CMD ["/bin/bash"]
USER buildworker
